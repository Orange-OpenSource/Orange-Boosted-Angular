dist: trusty
sudo: false

language: node_js
node_js:
  - "10.4.1"

addons:
  chrome: stable,

cache:
  directories:
     - ./node_modules

install:
  - npm install

jobs:
  include:
    - stage: Lib test
      script:
        - npm run test ng-boosted -- --no-watch --no-progress --browsers=ChromeHeadless
    - stage: Npm Release
      node_js: "10.4.1"
      script:
        - echo "Deploying to NPM..."
        - npm run build:lib
        - cp ./README.md dist/ng-boosted
      before_deploy:
        - cd dist/ng-boosted
      after_deploy:
        - cd ../../
      deploy:
        provider: npm
        skip_cleanup: true
        email: $NPM_EMAIL
        api_key: $NPM_TOKEN
        on:
          tags: true
          all_branches: true