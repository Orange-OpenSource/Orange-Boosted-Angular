dist: trusty
sudo: false

language: node_js
node_js:
  - "10.9.0"

addons:
  chrome: stable,

cache:
  directories:
     - ./node_modules

install:
  - npm install

script:
  - npm run test ng-boosted -- --no-watch --no-progress --browsers=ChromeHeadless

before_deploy:
  - npm run build:docs
  - "echo 'Deployement launched...'"

deploy:
  - provider: pages
    skip_cleanup: true
    script: cd Orange-Boosted-Angular
    github_token: $GITHUB_TOKEN
    keep_history: true
    deployment: dist/Orange-Boosted-Angular
    fqdn: ng-boosted.orange.com
    on:
      branch: refacto-structure

before_deploy:
  - npm run build:lib
  - cp ./README.md dist/ng-boosted
  - cd dist/ng-boosted

deploy:
  - provider: npm
    skip_cleanup: true
    script: cd ng-boosted
    email: $NPM_EMAIL
    api_key: $NPM_TOKEN
    deployment: dist/ng-boosted
    on:
      tags: true
      all_branches: true